<!DOCTYPE html>
<html>
<head>
    <title>Petition</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
<h1 id="title"></h1>
<p id="description"></p>
<p>Signatures: <span id="signature-count">0</span></p>

<h3>Sign this petition</h3>
<form id="signForm">
    <button type="submit">Sign Petition</button>
</form>

<p id="message"></p>

<a href="index.html">Back to All Petitions</a>

<script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    const titleEl = document.getElementById('title');
    const descEl = document.getElementById('description');
    const countEl = document.getElementById('signature-count');
    const messageEl = document.getElementById('message');

    // Load petition
    function loadPetition() {
        fetch(`/petitions/${id}`)
            .then(res => res.json())
            .then(p => {
                titleEl.innerText = p.title;
                descEl.innerText = p.description;
                countEl.innerText = p.signatures;
            });
    }

    loadPetition();

    // Sign petition
    document.getElementById('signForm').addEventListener('submit', function(e) {
        e.preventDefault();

        fetch(`/petitions/${id}/sign`, { method: 'POST' })
            .then(r => {
                if (r.ok) {
                    messageEl.innerText = "Signed successfully!";
                    loadPetition(); // refresh signature count
                } else {
                    messageEl.innerText = "Failed to sign.";
                }
            });
    });
</script>
</div>
</body>
</html>
